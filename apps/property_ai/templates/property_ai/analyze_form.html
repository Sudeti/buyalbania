<!-- ENHANCED: Premium analyze_form.html -->
{% extends "property_ai/base.html" %}

{% block title %}Analyze Property - PropertyAI{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="mx-auto" style="max-width: 800px;">
        <!-- Header -->
        <div class="text-center mb-5 fade-in">
            <h1 class="display-4 fw-bold mb-4">
                Analyze Any Albanian Property
            </h1>
            <p class="lead text-muted mb-4">
                Get professional AI-powered investment analysis in seconds
            </p>
        </div>

        <!-- Quota Info -->
        {% if user.is_authenticated and quota_info %}
        <div class="alert alert-info fade-in" style="animation-delay: 0.1s;">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <strong>{{ quota_info.tier|title }} Plan:</strong> 
                    {% if quota_info.tier == 'free' %}
                        {{ quota_info.remaining }} analysis remaining this month
                    {% elif quota_info.tier == 'basic' %}
                        {{ quota_info.remaining }} analyses remaining this month
                    {% else %}
                        Unlimited analyses available
                    {% endif %}
                </div>
                {% if quota_info.tier != 'premium' %}
                <div>
                    {% if quota_info.tier == 'free' %}
                        <a href="#upgrade" class="btn btn-success btn-sm">Upgrade - €5/month</a>
                    {% elif quota_info.tier == 'basic' %}
                        <a href="#upgrade" class="btn btn-warning btn-sm">Go Premium - €15/month</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Main Form Card -->
        <div class="card border-primary border-opacity-25 bg-primary bg-opacity-5 fade-in" style="animation-delay: 0.2s;">
            <div class="card-body p-5">
                <form action="{% url 'property_ai:analyze_property' %}" method="post">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label for="property_url" class="form-label fw-semibold">
                            Century 21 Albania Property URL
                        </label>
                        <div class="input-group input-group-lg">
                            <input type="url" 
                                   class="form-control" 
                                   id="property_url"
                                   name="property_url" 
                                   placeholder="https://www.century21albania.com/property/apartment-for-sale..."
                                   required
                                   {% if user.is_authenticated and quota_info and not quota_info.can_analyze %}disabled{% endif %}>
                            
                            {% if not user.is_authenticated %}
                                <a href="{% url 'accounts:register' %}" class="btn btn-primary">
                                    Sign Up to Analyze
                                </a>
                            {% elif quota_info and quota_info.can_analyze %}
                                <button type="submit" class="btn btn-primary">
                                    <span>Analyze Property</span>
                                    <i class="bi bi-rocket ms-2"></i>
                                </button>
                            {% else %}
                                <button type="button" class="btn btn-secondary" disabled>
                                    Quota Reached
                                </button>
                            {% endif %}
                        </div>
                        
                        <div class="form-text mt-2">
                            <i class="bi bi-lightbulb me-1"></i>
                            Copy and paste any property listing URL from Century 21 Albania
                        </div>
                    </div>

                    {% if not user.is_authenticated or quota_info and not quota_info.can_analyze %}
                    <div class="text-center mt-4">
                        {% if not user.is_authenticated %}
                            <div class="alert alert-info">
                                <div>
                                    <strong><i class="bi bi-gift me-2"></i>Create your free account to get started</strong>
                                    <div class="mt-2">
                                        • 1 free analysis per month<br>
                                        • Professional investment insights<br>
                                        • Market comparison data
                                    </div>
                                </div>
                            </div>
                        {% elif quota_info and not quota_info.can_analyze %}
                            <div class="alert alert-warning">
                                <div>
                                    <strong>Monthly quota reached</strong>
                                    <div class="mt-2">
                                        {% if quota_info.tier == 'free' %}
                                            Upgrade to Basic for 10 analyses per month
                                        {% elif quota_info.tier == 'basic' %}
                                            Upgrade to Premium for unlimited analyses
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </form>
            </div>
        </div>

        <!-- Features Preview -->
        <div class="row g-4 mt-5">
            <div class="col-lg-6 col-md-6">
                <div class="card h-100 fade-in" style="animation-delay: 0.3s;">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px; color: var(--bs-primary); font-size: 1.25rem;">
                            <i class="bi bi-graph-up"></i>
                        </div>
                        <h3 class="h6 mb-3">Investment Scoring</h3>
                        <p class="text-muted small mb-0">
                            Get a comprehensive 0-100 investment score based on market data, location, and property fundamentals
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-6">
                <div class="card h-100 fade-in" style="animation-delay: 0.4s;">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-success bg-opacity-10 d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px; color: var(--bs-success); font-size: 1.25rem;">
                            <i class="bi bi-house"></i>
                        </div>
                        <h3 class="h6 mb-3">Market Analysis</h3>
                        <p class="text-muted small mb-0">
                            Compare with similar properties, rental yields, and neighborhood market positioning
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-6">
                <div class="card h-100 fade-in" style="animation-delay: 0.5s;">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-warning bg-opacity-10 d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px; color: var(--bs-warning); font-size: 1.25rem;">
                            <i class="bi bi-lightbulb"></i>
                        </div>
                        <h3 class="h6 mb-3">Smart Insights</h3>
                        <p class="text-muted small mb-0">
                            Receive actionable recommendations, risk assessment, and negotiation strategies
                        </p>
                    </div>
                </div>
            </div>

            <div class="col-lg-6 col-md-6">
                <div class="card h-100 fade-in" style="animation-delay: 0.6s;">
                    <div class="card-body text-center p-4">
                        <div class="rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px; color: var(--bs-primary); font-size: 1.25rem;">
                            <i class="bi bi-file-earmark-text"></i>
                        </div>
                        <h3 class="h6 mb-3">PDF Reports</h3>
                        <p class="text-muted small mb-0">
                            Download professional reports perfect for presentations, financing, or record keeping
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- How It Works -->
        <div class="card mt-5 text-center">
            <div class="card-body p-5">
                <h2 class="display-6 fw-bold mb-5">
                    How It Works
                </h2>
                
                <div class="row g-4">
                    <div class="col-lg-4 col-md-4">
                        <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px; color: white; font-size: 1.5rem; font-weight: 700; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                            1
                        </div>
                        <h3 class="h6 mb-3">Paste URL</h3>
                        <p class="text-muted small">
                            Find any property on Century 21 Albania and copy the URL
                        </p>
                    </div>
                    
                    <div class="col-lg-4 col-md-4">
                        <div class="rounded-circle bg-success d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px; color: white; font-size: 1.5rem; font-weight: 700; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);">
                            2
                        </div>
                        <h3 class="h6 mb-3">AI Processing</h3>
                        <p class="text-muted small">
                            Our AI analyzes property details, market data, and comparable sales
                        </p>
                    </div>
                    
                    <div class="col-lg-4 col-md-4">
                        <div class="rounded-circle bg-warning d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px; color: white; font-size: 1.5rem; font-weight: 700; box-shadow: 0 8px 32px rgba(245, 158, 11, 0.3);">
                            3
                        </div>
                        <h3 class="h6 mb-3">Get Results</h3>
                        <p class="text-muted small">
                            Receive comprehensive analysis with investment score and recommendations
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}