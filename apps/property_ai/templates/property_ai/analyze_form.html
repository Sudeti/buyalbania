{% extends "property_ai/base.html" %}

{% block title %}Analyze Property{% endblock %}

{% block page_header %}
<h1>Analyze Any Albanian Property</h1>
<p class="lead">Get professional AI-powered investment analysis in seconds</p>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      
      <!-- Quota Info -->
      {% if user.is_authenticated and quota_info %}
      <div class="alert alert-info text-center">
        <strong>{{ quota_info.tier|title }} Plan:</strong> 
        {% if quota_info.tier == 'free' %}
          {{ quota_info.remaining }} analysis remaining
        {% elif quota_info.tier == 'basic' %}
          {{ quota_info.remaining }} analyses remaining
        {% else %}
          Unlimited analyses
        {% endif %}
      </div>
      {% endif %}
      
      <!-- Main Form -->
      <div class="card">
        <div class="card-body p-4">
          <form action="{% url 'property_ai:analyze_property' %}" method="post">
            {% csrf_token %}
            
            <div class="mb-4">
              <label for="property_url" class="form-label">Century 21 Property URL</label>
              <input type="url" 
                     class="form-control form-control-lg" 
                     id="property_url"
                     name="property_url" 
                     placeholder="https://www.century21albania.com/property/..."
                     required
                     {% if user.is_authenticated and quota_info and not quota_info.can_analyze %}disabled{% endif %}>
            </div>
            
            <div class="d-grid">
              {% if not user.is_authenticated %}
                <a href="{% url 'accounts:register' %}" class="btn btn-primary btn-lg">
                  Sign Up to Analyze - Free
                </a>
              {% elif quota_info and quota_info.can_analyze %}
                <button type="submit" class="btn btn-primary btn-lg">
                  Analyze Property
                </button>
              {% else %}
                <button type="button" class="btn btn-secondary btn-lg" disabled>
                  Monthly Quota Reached
                </button>
                <div class="mt-3 text-center">
                  {% if quota_info.tier == 'free' %}
                    <a href="#upgrade" class="btn btn-success">Upgrade to Basic - €5/month</a>
                  {% elif quota_info.tier == 'basic' %}
                    <a href="#upgrade" class="btn btn-warning">Upgrade to Premium - €15/month</a>
                  {% endif %}
                </div>
              {% endif %}
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}